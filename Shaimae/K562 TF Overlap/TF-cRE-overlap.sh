#!/bin/bash
# Author: Shaimae Elhajjajy
# Script that uses bedtools intersect to find the percent overlap between K562 cREs and TF ChIP-seq peaks

# Get ENCODE file information (experiment ID, peak file ID, TF name) from the text file
awk '{print $1}' ./K562-TF.txt > experimentNames.txt
awk '{print $2}' ./K562-TF.txt > peakFileNames.txt
awk '{print $3}' ./K562-TF.txt > targetNames.txt

# Create arrays for each of the three types of file information from above
experiment=( `cat "experimentNames.txt" `)
peakFile=( `cat "peakFileNames.txt" `)
target=( `cat "targetNames.txt" `)

# Create array for the cRE information
cREs=( `cat "K562-cRE.txt" `)

# Find the number of TFs that will be intersected
numberOfTFs=`cat "targetNames.txt" | wc -l`

# Find the upper limit of the range of the for loop
limit=$(( $numberOfTFs - 1 ))

# Make new directory to store all the TF files
mkdir K562TFfiles

# Make new directory to store all the results
mkdir K562OverlapResults

# Set up the result files with headers 
for k in {0..5}
do
	# Strip the ".bed" extension from the cRE file name
	fileName=`basename ./K562cREfiles/${cREs[$k]} .bed`
	# Create the header and write it to each results file
	echo -e Experiment '\t' Peak File '\t' Target '\t' Number of Overlaps '\t' Percent Overlap '\t' >> ./K562OverlapResults/$fileName-Overlap.txt
done

# Cycle through each TF file and intersect with each cRE to find the percent overlap

for i in $(seq 0 $limit)
do
	# Copy the TF file to the current directory
	cp /data/projects/encode/data/${experiment[$i]}/${peakFile[$i]}.bed.gz ./K562TFfiles/
	# Unzip the file
	gunzip ./K562TFfiles/${peakFile[$i]}.bed.gz
	
	# Perform bedtools intersect 
	for j in {0..5}
	do
		# Find the number of intersections between the cRE and the TF
		numberOfOverlaps=$( bedtools intersect -u -a ./K562cREfiles/${cREs[$j]} -b ./K562TFfiles/${peakFile[$i]}.bed | wc -l )
		# Find the total number of cREs
		totalcREs=$( wc -l ./K562cREfiles/${cREs[$j]} | cut -f 1 -d ' ' )
		# Find the percent overlap between the cRE and the TF
		percentOverlap=$( awk "BEGIN {printf \"%.2f\", $numberOfOverlaps / $totalcREs * 100 }")
		# Strip the ".bed" extension from the cRE file name
		fileName=`basename ./K562cREfiles/${cREs[$j]} .bed`
		# Append the results to the file
		echo -e ${experiment[$i]} '\t' ${peakFile[$i]} '\t' ${target[$i]} '\t' $numberOfOverlaps '\t' $percentOverlap >> ./K562OverlapResults/$fileName-Overlap.txt
	done
done

# ---------------------

# Contents of "K562-TF.txt"

# ENCSR641BSL	ENCFF836VRV	AGO1
# ENCSR822CCM	ENCFF225MPC	ARID1B
# ENCSR613NUC	ENCFF471ZTZ	ARNT
# ENCSR155KHM	ENCFF507MGL	ARNT
# ENCSR000DNZ	ENCFF002CVM	ATF1
# ENCSR869IUD	ENCFF968KBN	ATF2
# ENCSR000DOG	ENCFF002CVN	ATF3
# ENCSR000EGD	ENCFF423EMU	BACH1
# ENCSR492LTS	ENCFF462CPT	BCLAF1
# ENCSR000BKH	ENCFF002CLP	BCLAF1
# ENCSR000BKH	ENCFF203EDM	BCLAF1
# ENCSR808AKZ	ENCFF057ZUY	BCOR
# ENCSR000DOK	ENCFF002CVP	BDP1
# ENCSR000EGV	ENCFF179NDS	BHLHE40
# ENCSR782WRO	ENCFF633VCV	BMI1
# ENCSR583ACG	ENCFF714XHL	BRD4
# ENCSR000DOJ	ENCFF002CVR	BRF1
# ENCSR000DOC	ENCFF002CVS	BRF2
# ENCSR350XWY	ENCFF996ZGL	C11orf30
# ENCSR948QLZ	ENCFF484DKT	CBX1
# ENCSR000BRT	ENCFF455TDM	CBX3
# ENCSR272JAT	ENCFF062ARS	CBX5
# ENCSR000ATW	ENCFF456PQY	CBX8
# ENCSR000DOA	ENCFF002CVU	CCNT2
# ENCSR121PFY	ENCFF643TEZ	CDC5L
# ENCSR618GDK	ENCFF392TKK	CEBPZ
# ENCSR065XVO	ENCFF859FVX	CHAMP1
# ENCSR130HEG	ENCFF684MLP	COPS2
# ENCSR109YGM	ENCFF708GFU	CREB3L1
# ENCSR077DKV	ENCFF948TXN	CREM
# ENCSR000DWE	ENCFF002DDJ	CTCF
# ENCSR000AKO	ENCFF002CEL	CTCF
# ENCSR000EGM	ENCFF738TKN	CTCF
# ENCSR000DMA	ENCFF002DBD	CTCF
# ENCSR446LAV	ENCFF338HQY	DDX20
# ENCSR387SYS	ENCFF786WZD	DEAF1
# ENCSR987PBI	ENCFF034PQD	DNMT1
# ENCSR715CCR	ENCFF823SYE	DPF2
# ENCSR563LLO	ENCFF998YJY	E2F1
# ENCSR440VKE	ENCFF396GUH	eGFP-ADNP
# ENCSR091GVJ	ENCFF232KAH	eGFP-ATF1
# ENCSR632DCH	ENCFF228PSB	eGFP-ATF3
# ENCSR740NPG	ENCFF319BCP	eGFP-BACH1
# ENCSR416QLJ	ENCFF828JWK	eGFP-CEBPB
# ENCSR620VIC	ENCFF606CCB	eGFP-CEBPG
# ENCSR490LWA	ENCFF272ULO	eGFP-CEBPG
# ENCSR093FKD	ENCFF665FHC	eGFP-CREB3
# ENCSR178NTX	ENCFF695CPH	eGFP-CUX1
# ENCSR382AIB	ENCFF009DUY	eGFP-DDX20
# ENCSR167JBG	ENCFF408SNO	eGFP-DIDO1
# ENCSR709DRM	ENCFF356ASJ	eGFP-E2F5
# ENCSR975SSR	ENCFF526EEI	eGFP-ELF1
# ENCSR338QAC	ENCFF904ZGQ	eGFP-ELK1
# ENCSR596IKD	ENCFF772HOY	eGFP-ETS2
# ENCSR277DMR	ENCFF404YMX	eGFP-ETV1
# ENCSR239ZLZ	ENCFF692PVV	eGFP-FOSL1
# ENCSR847LBF	ENCFF452SPE	eGFP-FOXJ2
# ENCSR290MUH	ENCFF685KAG	eGFP-GABPA
# ENCSR000DKA	ENCFF929YBC	eGFP-GATA2
# ENCSR801RPW	ENCFF167HYX	eGFP-GTF2A2
# ENCSR532KTI	ENCFF778RMG	eGFP-GTF2E2
# ENCSR835TCD	ENCFF939ZFS	eGFP-HDAC8
# ENCSR000DJZ	ENCFF833KXP	eGFP-HDAC8
# ENCSR619GFP	ENCFF265LKN	eGFP-HINFP
# ENCSR005NMT	ENCFF835YLR	eGFP-ID3
# ENCSR648INT	ENCFF176NOI	eGFP-ILK
# ENCSR854MCV	ENCFF388AJH	eGFP-IRF1
# ENCSR926KTP	ENCFF196DHR	eGFP-IRF9
# ENCSR550HCT	ENCFF717TWA	eGFP-KLF1
# ENCSR608HVP	ENCFF802XZN	eGFP-KLF13
# ENCSR818DQV	ENCFF927JBT	eGFP-MAFG
# ENCSR647ZXA	ENCFF257RYT	eGFP-MEF2D
# ENCSR552YGL	ENCFF911VSD	eGFP-NFE2
# ENCSR632SHZ	ENCFF175IUO	eGFP-NFE2L1
# ENCSR178DEG	ENCFF320THV	eGFP-NR2C1
# ENCSR750LYM	ENCFF254YOX	eGFP-NR2C2
# ENCSR130PDE	ENCFF859NPS	eGFP-NR4A1
# ENCSR000DJW	ENCFF030QEM	eGFP-NR4A1
# ENCSR263DFP	ENCFF168HAG	eGFP-PBX2
# ENCSR400FSM	ENCFF801YZV	eGFP-POLR2H
# ENCSR126FZN	ENCFF007DKB	eGFP-PTRF
# ENCSR314BBS	ENCFF332DRG	eGFP-PTTG1
# ENCSR410DWC	ENCFF421VCV	eGFP-PYGO2
# ENCSR772EEN	ENCFF580QGA	eGFP-RELA
# ENCSR671GFC	ENCFF411DIA	eGFP-TAF7
# ENCSR635GTR	ENCFF619BDC	eGFP-TEAD2
# ENCSR017GBO	ENCFF701MXF	eGFP-TFDP1
# ENCSR787RVK	ENCFF036YVI	eGFP-TSC22D4
# ENCSR359NFW	ENCFF417TXD	eGFP-USF2
# ENCSR706BJO	ENCFF462JFW	eGFP-ZBTB11
# ENCSR920ASP	ENCFF433RKB	eGFP-ZFX
# ENCSR448UKK	ENCFF529FWJ	eGFP-ZKSCAN8
# ENCSR011PEI	ENCFF721LDD	eGFP-ZNF175
# ENCSR580IAO	ENCFF853TZC	eGFP-ZNF197
# ENCSR117WTM	ENCFF545DAF	eGFP-ZNF24
# ENCSR674SCQ	ENCFF744SVC	eGFP-ZNF354B
# ENCSR598TIR	ENCFF834WGJ	eGFP-ZNF507
# ENCSR591CCL	ENCFF447QUG	eGFP-ZNF512
# ENCSR149ZBI	ENCFF815TTY	eGFP-ZNF584
# ENCSR603XLW	ENCFF602AXP	eGFP-ZNF589
# ENCSR845BCL	ENCFF120WOF	eGFP-ZNF639
# ENCSR729HVR	ENCFF173NRW	eGFP-ZNF644
# ENCSR737UST	ENCFF898FAQ	eGFP-ZNF740
# ENCSR532EMP	ENCFF545RHH	eGFP-ZNF740
# ENCSR194IJN	ENCFF248AOD	eGFP-ZNF766
# ENCSR257XVY	ENCFF654BMD	eGFP-ZNF83
# ENCSR502OEK	ENCFF392MUM	ELF1
# ENCSR638QHV	ENCFF502KHR	ELF4
# ENCSR486IFJ	ENCFF602OKQ	ESRRA
# ENCSR000FCE	ENCFF545VNY	ETV6
# ENCSR124BJR	ENCFF660VPM	ETV6
# ENCSR159OCC	ENCFF030HWZ	FLAG-ATF1
# ENCSR633EIC	ENCFF269EMM	FLAG-PBX2
# ENCSR000FAI	ENCFF002CVW	FOS
# ENCSR819LHG	ENCFF809YFY	FOXA1
# ENCSR508DQA	ENCFF492GXZ	FOXK2
# ENCSR302AWT	ENCFF248VHN	FOXK2
# ENCSR429QPP	ENCFF699ZII	FOXM1
# ENCSR051DXE	ENCFF142CPK	FUS
# ENCSR000EWM	ENCFF659WGE	GATA1
# ENCSR000EWG	ENCFF732HOE	GATA2
# ENCSR000DOE	ENCFF002CWR	GTF2B
# ENCSR000DOD	ENCFF002CYL	GTF3C2
# ENCSR000EFN	ENCFF474NLG	HCFC1
# ENCSR000AQF	ENCFF357NRL	HDAC1
# ENCSR568PGX	ENCFF605KFA	HDAC1
# ENCSR387UWP	ENCFF019ALY	HDAC1
# ENCSR075HTM	ENCFF562JDH	HDAC2
# ENCSR000AQG	ENCFF657VJX	HDAC2
# ENCSR000ATJ	ENCFF998HOR	HDAC6
# ENCSR563YDA	ENCFF849ZUF	HDGF
# ENCSR197ALX	ENCFF561WNI	HDGF
# ENCSR091JXL	ENCFF676NPW	HES1
# ENCSR757IIU	ENCFF558DSF	HMBOX1
# ENCSR000DOB	ENCFF002CWT	HMGN3
# ENCSR594BNR	ENCFF010STZ	HNRNPL
# ENCSR296MXW	ENCFF768TJI	HNRNPUL1
# ENCSR948VFL	ENCFF886VSU	IKZF1
# ENCSR395HWC	ENCFF968JVX	IKZF1
# ENCSR000EGU	ENCFF730RUF	IRF1
# ENCSR000EGL	ENCFF909LKK	IRF1
# ENCSR000EGT	ENCFF284VUQ	IRF1
# ENCSR376WCJ	ENCFF231TGQ	IRF2
# ENCSR000EGH	ENCFF077UYM	JUN
# ENCSR000EZX	ENCFF573GQX	JUN
# ENCSR000EZT	ENCFF417QAJ	JUN
# ENCSR000FAH	ENCFF002CWC	JUN
# ENCSR000EZW	ENCFF192BTP	JUN
# ENCSR795IYP	ENCFF426DUB	JUNB
# ENCSR000EGN	ENCFF337DKJ	JUND
# ENCSR086FZL	ENCFF772QPO	KAT8
# ENCSR360HRA	ENCFF838COI	KDM1A
# ENCSR908CMW	ENCFF738WCE	KDM1A
# ENCSR642VZY	ENCFF042RAK	KDM4B
# ENCSR000AQA	ENCFF368TYM	KDM5B
# ENCSR760UVO	ENCFF844HBQ	KLF16
# ENCSR735JCD	ENCFF325WUZ	KMT2B
# ENCSR530XQI	ENCFF314ULQ	L3MBTL2
# ENCSR343ELW	ENCFF659WAF	LEF1
# ENCSR000EGX	ENCFF812QPN	MAFK
# ENCSR221GAN	ENCFF470MLY	MBD2
# ENCSR990AZC	ENCFF679ITJ	MCM3
# ENCSR079WHK	ENCFF872YNU	MCM5
# ENCSR038RGL	ENCFF399GAE	MCM7
# ENCSR542WJU	ENCFF278ONE	MCM7
# ENCSR710WLO	ENCFF670ZCR	MGA
# ENCSR426MDV	ENCFF365NKO	MIER1
# ENCSR000FCB	ENCFF616LVN	MITF
# ENCSR107GRP	ENCFF440JJW	MLLT1
# ENCSR675LRO	ENCFF197OGH	MLLT1
# ENCSR979QYJ	ENCFF973OME	MNT
# ENCSR390VGH	ENCFF059ONJ	MNT
# ENCSR411UYA	ENCFF662MVX	MTA2
# ENCSR113LAS	ENCFF410EDG	MTA2
# ENCSR000EGS	ENCFF676YJE	MYC
# ENCSR000EZU	ENCFF099SDW	MYC
# ENCSR000EZV	ENCFF387LTN	MYC
# ENCSR000FAG	ENCFF002CWI	MYC
# ENCSR000FAZ	ENCFF634AYU	MYC
# ENCSR737LTZ	ENCFF833VYQ	MYNN
# ENCSR085QEV	ENCFF074EZL	NBN
# ENCSR931HNY	ENCFF701NVT	NCOA1
# ENCSR910JAI	ENCFF165BCW	NCOR1
# ENCSR798ILC	ENCFF366UBB	NCOR1
# ENCSR298JCG	ENCFF080NBZ	NCOR1
# ENCSR000FCC	ENCFF495MHZ	NFE2
# ENCSR000FAF	ENCFF002CXH	NFE2
# ENCSR657EOF	ENCFF157UUF	NFRKB
# ENCSR085DDI	ENCFF986MHU	NFXL1
# ENCSR000EGR	ENCFF002CXI	NFYA
# ENCSR000EGQ	ENCFF002CXJ	NFYB
# ENCSR415TXN	ENCFF134NMW	NONO
# ENCSR886RYH	ENCFF776YPS	NONO
# ENCSR742IDN	ENCFF664ZGR	NR2C1
# ENCSR000EWH	ENCFF594LCH	NR2C2
# ENCSR970NKQ	ENCFF175IIE	NR2F1
# ENCSR707QWA	ENCFF712AXK	NR2F6
# ENCSR494TDU	ENCFF638YFC	NRF1
# ENCSR837EYC	ENCFF144PPR	NRF1
# ENCSR998AJK	ENCFF809MSQ	NRF1
# ENCSR924GXX	ENCFF462FRU	PHB2
# ENCSR000AQH	ENCFF626KTJ	PHF8
# ENCSR115SMW	ENCFF544XKC	PKNOX1
# ENCSR000FAX	ENCFF206YXX	POLR2A
# ENCSR388QZF	ENCFF248IWJ	POLR2A
# ENCSR000FAJ	ENCFF002CXR	POLR2A
# ENCSR000EHP	ENCFF270QAB	POLR2A
# ENCSR000FAY	ENCFF662YQK	POLR2A
# ENCSR000FAW	ENCFF853ZMA	POLR2A
# ENCSR031TFS	ENCFF937VZI	POLR2A
# ENCSR000EHL	ENCFF002CXQ	POLR2A
# ENCSR000EGF	ENCFF296CNQ	POLR2AphosphoS2
# ENCSR000EHF	ENCFF002DDU	POLR2AphosphoS2
# ENCSR000DOI	ENCFF002CXW	POLR3A
# ENCSR000EHQ	ENCFF002CXT	POLR3G
# ENCSR948KMB	ENCFF694BIA	PTBP1
# ENCSR000FAD	ENCFF002CXU	RAD21
# ENCSR524BUE	ENCFF096XMD	RAD51
# ENCSR670JDQ	ENCFF975IRM	RB1
# ENCSR000AQI	ENCFF379MPS	RBBP5
# ENCSR822LBD	ENCFF120IDE	RBFOX2
# ENCSR137ZMQ	ENCFF895QLA	REST
# ENCSR041AXL	ENCFF237UAN	RFX1
# ENCSR968GIB	ENCFF010UHD	RFX1
# ENCSR530IUH	ENCFF309WAZ	RING1
# ENCSR076YPO	ENCFF972LPT	RNF2
# ENCSR608XTF	ENCFF644WLI	RNF2
# ENCSR820GND	ENCFF539WLH	RNF2
# ENCSR138FUZ	ENCFF485MXM	RNF2
# ENCSR588AKU	ENCFF820QQB	RUNX1
# ENCSR414TYY	ENCFF804ABO	RUNX1
# ENCSR000AQJ	ENCFF718NUA	SAP30
# ENCSR000EWI	ENCFF294EHN	SETDB1
# ENCSR920BLG	ENCFF191MPD	SIN3A
# ENCSR657JLK	ENCFF280GTU	SIN3B
# ENCSR000DOH	ENCFF002CXZ	SIRT6
# ENCSR000BGX	ENCFF002CMM	SIX5
# ENCSR000BNW	ENCFF033EBX	SIX5
# ENCSR189PYJ	ENCFF870PWV	SMAD2
# ENCSR000FCD	ENCFF178MOP	SMAD5
# ENCSR000EHO	ENCFF002CVT	SMARCA4
# ENCSR643VTW	ENCFF197YHU	SMARCA4
# ENCSR587OQL	ENCFF883TOD	SMARCA4
# ENCSR895HSJ	ENCFF995NIE	SMARCA5
# ENCSR000EHN	ENCFF002CWU	SMARCB1
# ENCSR157TCS	ENCFF622RBW	SMARCE1
# ENCSR754ZHU	ENCFF033KXY	SNRNP70
# ENCSR991ELG	ENCFF058NMZ	SP1
# ENCSR000BGW	ENCFF002CMJ	SPI1
# ENCSR815ZDS	ENCFF890YEO	SREBF1
# ENCSR000FAV	ENCFF290HTJ	STAT1
# ENCSR000FAU	ENCFF254MPF	STAT1
# ENCSR000EHJ	ENCFF648NYF	STAT1
# ENCSR000EHK	ENCFF498DOQ	STAT1
# ENCSR000FBC	ENCFF841YFF	STAT2
# ENCSR000FAT	ENCFF714VIT	STAT2
# ENCSR894CGX	ENCFF484HCG	SUPT5H
# ENCSR412CTM	ENCFF966MVC	SUZ12
# ENCSR047LSJ	ENCFF617CAZ	TAF15
# ENCSR106FRG	ENCFF284LRP	TAL1
# ENCSR000EHB	ENCFF002CYH	TAL1
# ENCSR353HEP	ENCFF588UCZ	TARDBP
# ENCSR033VAZ	ENCFF261XPP	TARDBP
# ENCSR429XTR	ENCFF905VXX	TARDBP
# ENCSR000EGA	ENCFF048OBR	TBL1XR1
# ENCSR000EGB	ENCFF626MVT	TBL1XR1
# ENCSR000EHA	ENCFF002CYK	TBP
# ENCSR189TRZ	ENCFF242IWJ	TCF12
# ENCSR744WOO	ENCFF493TZM	TCF12
# ENCSR863KUB	ENCFF249EZR	TCF7
# ENCSR888XZK	ENCFF312RFN	TCF7L2
# ENCSR224IKA	ENCFF560NIM	TFDP1
# ENCSR871TKJ	ENCFF294VWT	THRAP3
# ENCSR957LDM	ENCFF049CRW	TRIM24
# ENCSR907MZR	ENCFF646VQW	TRIM24
# ENCSR000BRW	ENCFF858QMI	TRIM28
# ENCSR000EVY	ENCFF591BIT	TRIM28
# ENCSR690GUG	ENCFF730URE	U2AF1
# ENCSR479QAJ	ENCFF398EQF	U2AF2
# ENCSR000EFW	ENCFF002CYN	UBTF
# ENCSR000EFZ	ENCFF002CYO	UBTF
# ENCSR107RHZ	ENCFF706LIT	YBX1
# ENCSR567JEU	ENCFF246HIU	YBX3
# ENCSR000EWF	ENCFF557DSM	YY1
# ENCSR286PCG	ENCFF650ELJ	ZBED1
# ENCSR331GDC	ENCFF434QZL	ZBTB11
# ENCSR230PTV	ENCFF561USY	ZBTB2
# ENCSR876GXA	ENCFF408FQC	ZBTB33
# ENCSR237VLT	ENCFF417LEJ	ZBTB40
# ENCSR000BME	ENCFF706ISJ	ZBTB7A
# ENCSR004GKA	ENCFF076IFG	ZEB2
# ENCSR322CFO	ENCFF407AOX	ZEB2
# ENCSR557RVF	ENCFF223KKR	ZHX1
# ENCSR882ERE	ENCFF163VUK	ZKSCAN1
# ENCSR907JPB	ENCFF597DIY	ZMIZ1
# ENCSR102KIN	ENCFF511QHY	ZMYM3
# ENCSR695EQB	ENCFF340PPI	ZNF24
# ENCSR099NCH	ENCFF973LDQ	ZNF24
# ENCSR385AHH	ENCFF238MYM	ZNF24
# ENCSR000EVX	ENCFF344QKL	ZNF274
# ENCSR000EWE	ENCFF836LBG	ZNF274
# ENCSR167KBO	ENCFF788EBS	ZNF316
# ENCSR334HSW	ENCFF698MLW	ZNF318
# ENCSR352BJL	ENCFF921WMN	ZNF318
# ENCSR011NOZ	ENCFF602CFZ	ZNF407
# ENCSR175SZH	ENCFF253NXR	ZSCAN29
# ENCSR780BBJ	ENCFF588OLK	ZZZ3

# Contents of "K562-cRE.txt"

# K562-Promoter.bed
# K562-Enhancer.bed
# K562-CTCF.bed
# K562-DNase-Group1.bed
# K562-DNase-Group2.bed
# K562-Inactive.bed

